
<%= stylesheet_link_tag "https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css" %>
<%= javascript_include_tag "http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" %>
<%= javascript_include_tag "http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" %>
<%= javascript_include_tag "https://code.highcharts.com/highcharts.js" %>
<%= javascript_include_tag "https://code.highcharts.com/highcharts-more.js" %>
<%= javascript_include_tag "https://code.highcharts.com/modules/exporting.js" %>

<%=search_field_tag :name,nil,remote: true,method:'get',id: :search_suggest %>
<script type="text/javascript">

/* Code for Chart Starts Here */
	$(function(){
		console.log("State Data :"<%=@state_data%>);
	var globalArray = []
	function load_script(myArray){
	globalArray.push(myArray)
    $("#container_graph").highcharts({
        chart: {
            polar: true,
            type: 'line'
        },

        title: {
            text: 'State vs Criterion',
            x: -80
        },

        pane: {
            size: '80%'
        },

        xAxis: {
            categories: ['Tropical', 'SubTropical', 'Mediterranean', 'Temperate',
                    'Urban', 'Sub-Urban', 'Rural', 'Men', 'Woman', 'Other', 'Men to Woman :Urban',
                    'Men to Woman :Sub-Urban', 'Men to Woman :Rural'],
            tickmarkPlacement: 'on',
            lineWidth: 0
        },

        yAxis: {
            gridLineInterpolation: 'polygon',
            lineWidth: 0,
            min: 0
        },

        tooltip: {
            shared: true,
            pointFormat: '<span style="color:{series.color}">{series.name}: <b>{point.y:,.0f}%</b><br/>'
        },

        legend: {
            align: 'right',
            verticalAlign: 'top',
            y: 70,
            layout: 'vertical'
        },
   		
        series: globalArray
    });
}
/* Code for Charts Ends Here */

/* Code for autocomplete search Starts */
var showPage;

$.getJSON("/cipher/search_suggestions").done(function(searchData) {
  var extractLast, split;
  console.log(searchData);
  split = function(val) {
    return val.split(/,\s*/);
  };
  extractLast = function(term) {
    return split(term).pop();
  };
  $('#search_suggest').bind('keydown', function(event) {
    if (event.keyCode === $.ui.keyCode.TAB && $(this).autocomplete('instance').menu.active) {
      event.preventDefault();
    }
  }).autocomplete({
    minLength: 0,
    source: function(request, response) {
      response($.ui.autocomplete.filter(searchData, extractLast(request.term)));
    },
    focus: function() {
      return false;
    },
    select: function(event, ui) {
      var terms;
      terms = split(this.value);
      terms.pop();
      terms.push(ui.item.value);
      showPage(terms[terms.length - 1]);
      terms.push('');
      this.value = terms.join(', ');
      return false;
    }
  });
  return;
});

/* Get Request to get values to Display on the Graph Start */
showPage = function(value) {
  var myArray = []
  console.log(value);
  $.getJSON('/cipher/state_data', {
    name: value
  }).done(function(data, status, e) {
  	console.log("data : "+data+" name: "+value);
  	load_script({
            name: value,
            data: data,
            pointPlacement: 'on'
        })
  });
};
/* Get Request to get values to Display on the Graph Ends */
// ---
// generated by coffee-script 1.9.2
/* Code for autocomplete search Ends */
});


</script>